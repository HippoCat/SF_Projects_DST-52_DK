# SF_Projects_DST-52_DK/module_04_Credit_Scoring

В этом репозитории хранится решениe "Проект 4. Компьютер говорит «Нет»".

Задача написать скоринговую модель предсказания дефолта клиентов банка.

С этой моделью принять участие в хакатоне на Kaggle.

Дмитрий Кузнецов, поток DST-52 (SkillFactory), 8-14 Июля 2021


## Рекомендованная последовательность действий от организаторов

1. Добавьте новые данные в исходный датасет.
2. Сделайте разведку новых признаков аналогично предыдущим. Используйте визуализацию, поиск уникальных значений, очистку и 3. поиск выбросов там, где это необходимо.
3. Включите новые признаки в анализ основных переменных, оцените их важность и вклад для модели, подумайте над тем, можно ли сгенерировать новые признаки на основе добавленных
4. Получите новое значение ROC AUC для новой модели и попробуйте улучшить ее результаты на основе подбора параметра регуляризации
5. Чтобы понять, к какому уровню вам стоит стремиться, достаточно взглянуть на таблицу лидеров соревнования.


## 0. Общие замечания по выполнению

1. Выполнял проект в одиночку, т.к. на призывы объединиться на платформе и в Slack никто не откликнулся.
2. Последовательность действий была следующая:
 - Берем train (73799 entries), его делаем его предобработку, так же делаем с ним различные действия с целью улучшить модель;
 - Далее разбиваем train (73799) на два сета - на одном учим, на другом проверяем качество нашей модели;
 - Далее с выбранной моделью нам нужно подготовить файл ‘submission.csv’ и представить его на Kagle;
 - Для этого делал над test ту же самую предобработку, потом текущую модель и применял её к исходному файлу test (36349 entries). Результатом применения нашей модели к test как раз и будет сет, который мы записываем в 'submission_r**.csv', и в нём как раз и будет 36349 prediction rows, как того требует Kaggle.
3. Проект выполнял делал локально на своем компе в Jupyter, файлы 'submission_r**.csv' сохранял локально, на Kaggle загружал руками.
4. По завершении проекта загрузил Notebook с решением на GitHub и на Kaggle.


## 1. Смотрим на признаки

### Описание данных:

- client_id - идентификатор клиента
- education - уровень образования
- sex - пол заемщика
- age - возраст заемщика
- car - флаг наличия автомобиля
- car_type - флаг автомобиля иномарки
- decline_app_cnt - количество отказанных прошлых заявок
- good_work - флаг наличия “хорошей” работы
- bki_request_cnt - количество запросов в БКИ
- home_address - категоризатор домашнего адреса
- work_address - категоризатор рабочего адреса
- income - доход заемщика
- foreign_passport - наличие загранпаспорта
- sna - связь заемщика с клиентами банка
- first_time - давность наличия информации о заемщике
- score_bki - скоринговый балл по данным из БКИ
- region_rating - рейтинг региона
- app_date - дата подачи заявки
- default - флаг дефолта по кредиту

### Прошелся по каждому признаку, посмотрел на пропорции, распределения и пр.

####  1.1. Краткие выводы о колонке 'age'

- Пропусков и выбросов нет
- Распределение с тяжелым правым хвостом - молодые более склонны брать кредиты
- Возраст дефолтных клиентов в среднем ниже: 38.5 против 39.4 у недефолтных
- Медиана возраста у дефолтных ниже: 36 против 38
- Пока ничего не буду делать
- Потом можно попробовать логарифмировать, хотя распределение логарифма не сказать, что сильно отличается

#### 1.2. Наблюдения о колонке 'decline_app_cnt'

- Первое впечатление от признака 'decline_app_cnt' - непонятно, что это за люди такие, которые получают много отказов, но при этом продолжают снова и снова обращаться в банк за кредитом. Особенно из этой группы странных людей удивляют __недефолтные__, то есть те, кому вроде как можно бы и дать кредит.
- Как мы видим, у 33 человек кол-во отказов более 10, из них недефолтных аж целых 16. Вот уж дейстивтельно странные люди...
- Еще наблюдение - в данном случае медиана и границы выбросов совпадают, то есть всё, что не равно 0 является выбросами.
- Это всё лирика, сделать признак категориальным по принципу "раз, два, три, много".

####  1.3. Краткие выводы о колонке 'score_bki'

- Пропусков нет 
- Выбросов не более 0.5%
- Распределение визуально нормальное
- У дефолтных клиентов средний скоринговый балл ниже: -1.7 против -1,9 у недефолтных

#### 1.4. Краткие выводы о колонке 'income'

- Пропусков нет 
- Выбросов 6.4%
- Распределение визуально далеко от нормального
- Boxplot малоинформативен из-за сильного разброса
- У дефолтных клиентов средний доход ниже: 36292 против клиентов 41795 у недефолтных

#### 1.5. Наблюдения о колонке 'bki_request_cnt'

- Ситуация аналогична ситуации с признаком 'decline_app_cnt' - непонятно, что это за люди, по которы делается такое большое количество запросов в БКИ? Причем среди таких людей примерно 25-30% дефолтных.
- Среднее для дефолтных (стрёмных) клиентов 2.5, для НЕдефолтных (годных) клиентов 1.9
- Я не вполне понимаю физический смысл такого количества запросов.
- В общем очень хочется удалить всех, для кого количество запросов больше какого-то порогового занчения.
- Если будет время, можно поиграться с логарифмированием и удалением выбросов.

#### 1.6. Наблюдения о колонке 'region_rating'

- по факту это ординальный признак - значений всего 7 - от 20 до 80
- регионов с рейтингом 20 и 30 очень немного - 505 или 0.7% от всего количества
- Средний 'region_rating' для дефолтных клиентов 53.7, для годных клиентов 57.2
- Примерный физический смысл 'region_rating' - чем ниже рейтинг региона, тем больше дефолтных клиентов

#### 1.7. Наблюдения о колонке 'education':

- ординальный признак - значений всего 5 и они упорядочены
- образованных клиентов уровня postgraduate и academic degree мало, суммарно около 2%
- больше всего среди обратившихся за кредитом наименее образованных - 53%
- интересно, почему бакалавры реже ходят за кредитами, чем магистры? Возможно заняты учёбой :-)
- налицо обратная зависимость между уровнем образования и вероятностью дефолта
- количество дефолтных падает с 15% среди наименее образованных до 4% среди "академиков"

#### 1.8. Наблюдения о колонке 'sex'

- бинарный признак - М и Ж
- женщины в среднем чуть чаще обращаются за кредитами - 56% против 44%
- уровень дефолтности различается незначительно - 12 и 13 %

#### 1.9. Наблюдения о колонке 'car'

- бинарный признак - есть авто или нет
- безлошадных 67.5% - видимо берут кредит на покупку авто :-)
- уровень дефолтности для клиентов без авто 13.7%, у клиентов с авто 10.6%

#### 1.10. Наблюдения о колонке 'car_type'

- бинарный признак - иномарка или нет
- на иномарках всего 19% клиентов
- уровень дефолтности у "иномарочников" ниже - 8.7%, против 13.6% у адептов отечественного автопрома

#### 1.11. Наблюдения о колонке 'good_work':

- бинарный признак - работа либо хорошая, либо плохая
- с хорошей работой всего 16% - ну ещё бы...
- уровень дефолтности у обладателей "хорошей работы" ниже - 9.5%, против 13.3% у остальных

#### 1.12. Наблюдения о колонке 'home_address':

- категориальный признак с тремя вариантами [1, 2, 3] и непонятным физическим смыслом
- Клиентов в категории '1' - 44.2%, '2' - 54.1% и '3' - 1.7% от общего числа клиентов
- Дефолтных соответсвтенно 9.3%, 15.5% и 11.6%

#### 1.13. Наблюдения о колонке 'work_address':

- категориальный признак с тремя вариантами [1, 2, 3] и непонятным физическим смыслом
- Клиентов в категории '1' - 11.3%, '2' - 27.8% и '3' - 60.9% от общего числа клиентов
- Дефолтных соответсвтенно 7.4%, 10.3% и 14.8% - то есть налицо положительная связь между 'work_address' и дефолтностью

#### 1.14. Наблюдения о колонке 'sna':

- Категориальный признак с четырьмя вариантами [1, 2, 3, 4] и непонятным физическим смыслом;
- Больше клиентов в категории '1' - 64.1%;
- Пропорция дефолтных тем выше, чем выше категория 'sna' от 9.8% для категории '1' до 21.2% для категории '4'.

#### 1.15. Наблюдения о колонке 'first_time':

- Категориальный признак с четырьмя вариантами [1, 2, 3, 4], предположительно чем больше показатель, тем дольше у банка имеется в наличии информация о заемщике;
- Больше клиентов в категории '3' - 42.4%;
- Пропорция дефолтных тем ниже, чем выше категория 'first_time' от 18.6% для категории '1' до 8.2% для категории '4'.

#### 1.16. Наблюдения о колонке 'foreign_passport':

- бинарный признак - есть паспорт или нет
- безпаспортных 85.0%
- уровень дефолтности для клиентов без паспорта существенно выше - 13.6%, у клиентов с паспортом лишь 7.4%

#### 1.17. Наблюдения о колонке 'app_date':

- для наивной модели пока просто удалим, а дальше поглядим.


## 2. Строим различные модели

### 2.1. Наивная модель - submission_r01_naive







## Комментарии на будущее

Что можно улучшать:

1. Больше времени оставлять на проекты, 5 дней уже недостаточно. Минимум - полная неделя!;
2. Многие рутинные вещи занимают много времени, нужно больше практики. Часто упираешься просто в собственные "тупые" ошибки, из-за которых тратишь много времени впустую и расстраиваешься из-за собственной глупости или невнимательности;
3. Надо учить матчасть, учиться быстро разбираться с новыми методами и подходами.



Буду рад любой обратной связи, замечаниям и конструктивной критике об этом проекте, как от команды курса SkillFactory, так и от коллег однокурсников.

Заранее благодарен.

Д.К.
14 Июля 2021, 16:00